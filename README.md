# Universal Timeline Parser

è¤‡æ•°ã®GISãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆã™ã‚‹æ±ç”¨çš„ãªãƒ‘ãƒ¼ã‚µãƒ¼ã§ã™ã€‚

## ğŸš¨ è²¢çŒ®è€…ã‚’æ±‚ã‚ã¦ã„ã¾ã™ï¼

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§é–‹ç™ºã•ã‚Œã¦ãŠã‚Šã€æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®ã‚µãƒãƒ¼ãƒˆã€æ©Ÿèƒ½æ‹¡å¼µã€ãƒã‚°ä¿®æ­£ãªã©ã‚’æ‰‹ä¼ã£ã¦ãã ã•ã‚‹è²¢çŒ®è€…ã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚ç‰¹ã«ä»¥ä¸‹ã®åˆ†é‡ã§ã®è²¢çŒ®ã‚’æ­“è¿ã—ã¾ã™ï¼š

- GPXã€KMLãªã©ã®æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®ã‚µãƒãƒ¼ãƒˆ
- ãƒ‡ãƒ¼ã‚¿ã®è¦–è¦šåŒ–æ©Ÿèƒ½
- ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®å……å®Ÿ

è²¢çŒ®æ–¹æ³•ã«ã¤ã„ã¦ã¯ã€[CONTRIBUTING.md](CONTRIBUTING.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚åˆã‚ã¦ã®è²¢çŒ®è€…å‘ã‘ã«ã€ŒGood First Issueã€ã‚¿ã‚°ã®ä»˜ã„ãŸIssueã‚‚ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®æ¨™

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ã‚ã‚‰ã‚†ã‚‹GISãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã€GPSãƒ­ã‚°ãªã©ï¼‰ã‚’å˜ä¸€ã®çµ±åˆãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿ç®¡ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ä»Šå¾Œ [Pathfinder](https://pathfinder.dk-core.com/) ã®é–‹ç™ºã«å½¹ç«‹ã¦ã‚‹ãŸã‚ã®ã€æ±ç”¨çš„ã‹ã¤åŒ…æ‹¬çš„ãªDBã®ä½œæˆã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

ç¾åœ¨ã¯ã€AndroidãŠã‚ˆã³iPhoneã®ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹Google Timelineãƒ‡ãƒ¼ã‚¿ã®ã¿ã«å¯¾å¿œã—ã¦ã„ã¾ã™ãŒã€ä»Šå¾Œã¯GPXå½¢å¼ã‚„ãã®ä»–ã®ä½ç½®æƒ…å ±ãƒ‡ãƒ¼ã‚¿å½¢å¼ã«ã‚‚æ‹¡å¼µã—ã¦ã„ãäºˆå®šã§ã™ã€‚

## æ§‹é€ 

```
timeline/
â”œâ”€â”€ main.py                 # ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ config.py               # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ modules/                # æ©Ÿèƒ½åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ file_handler.py     # ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
â”‚   â”œâ”€â”€ json_parser.py      # JSONè§£æ
â”‚   â”œâ”€â”€ data_converter.py   # ãƒ‡ãƒ¼ã‚¿å¤‰æ›
â”‚   â””â”€â”€ csv_exporter.py     # CSVå‡ºåŠ›
â”œâ”€â”€ data/                   # å…¥åŠ›ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆGitç®¡ç†å¤–ï¼‰
â””â”€â”€ timeline_output.csv     # å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
```

## ä½¿ç”¨æ–¹æ³•

### 1. ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®
```bash
# Google Timelineã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’dataãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
cp your_timeline.json data/
```

### 2. å®Ÿè¡Œ
```bash
# ä»®æƒ³ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–ï¼ˆåˆå›ã®ã¿ï¼‰
python -m venv venv
source venv/bin/activate  # Linuxã®å ´åˆ
venv\Scripts\activate     # Windowsã®å ´åˆ

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
pip install -r requirements.txt

# å®Ÿè¡Œ
python main.py
```

### 3. çµæœç¢ºèª
- `timeline_output.csv` ãŒç”Ÿæˆã•ã‚Œã¾ã™
- æ™‚é–“é †ã«ã‚½ãƒ¼ãƒˆã•ã‚ŒãŸçµ±åˆãƒ‡ãƒ¼ã‚¿ãŒå‡ºåŠ›ã•ã‚Œã¾ã™

### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ä½¿ç”¨

é–‹ç™ºã‚„ãƒ†ã‚¹ãƒˆã®ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒ`sample_data`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ï¼š

```bash
# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’dataãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼
cp sample_data/sample_android.json data/
cp sample_data/sample_iphone.json data/

# ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’å®Ÿè¡Œ
python main.py
```

## ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼

ç¾åœ¨ã€ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š

1. **Google Timelineï¼ˆAndroidï¼‰** - Androidãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸJSONå½¢å¼
2. **Google Timelineï¼ˆiPhoneï¼‰** - iPhoneãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸJSONå½¢å¼

ä»Šå¾Œå¯¾å¿œäºˆå®šã®å½¢å¼ï¼š
- GPXï¼ˆGPS Exchange Formatï¼‰
- KML/KMZï¼ˆGoogle Earthå½¢å¼ï¼‰
- ãã®ä»–ã®GPSãƒˆãƒ©ãƒƒã‚«ãƒ¼ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿å½¢å¼

## å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å½¹å‰²

### config.py
- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹è¨­å®š
- å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åè¨­å®š
- CSVã‚«ãƒ©ãƒ å®šç¾©
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¨­å®š

### file_handler.py
- æ§˜ã€…ãªå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢ã¨èª­ã¿è¾¼ã¿
- ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆè¤‡æ•°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¯¾å¿œï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åç”Ÿæˆ

### json_parser.py
- Android/iPhoneå½¢å¼ã®è‡ªå‹•åˆ¤åˆ¥
- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®è§£æ
- visit/activity/timelinePathã®æŠ½å‡º
- åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡º

### data_converter.py
- æ™‚é–“å¤‰æ›ï¼ˆç¾åœ°æ™‚é–“â†’UTCï¼‰
- æ•°å€¤ãƒ‡ãƒ¼ã‚¿ã®æ­£è¦åŒ–
- DataFrameã®çµåˆ
- æ™‚é–“é †ã‚½ãƒ¼ãƒˆ

### csv_exporter.py
- CSVãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
- ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
- çµæœã‚µãƒãƒªãƒ¼è¡¨ç¤º

## ç‰¹å¾´

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ
- **å˜ä¸€è²¬ä»»åŸå‰‡**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæ˜ç¢ºãªå½¹å‰²ã‚’æŒã¡ã€ç‹¬ç«‹ã—ã¦æ©Ÿèƒ½
- **æ‹¡å¼µæ€§**: æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®è¿½åŠ ãŒå®¹æ˜“
- **å†åˆ©ç”¨æ€§**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å†åˆ©ç”¨å¯èƒ½

### æŸ”è»Ÿãªè¨­å®š
- `config.py`ã§ä¸€å…ƒç®¡ç†
- ã‚«ãƒ©ãƒ å®šç¾©ã®é›†ä¸­ç®¡ç†
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ

### å¼·åŠ›ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- è¤‡æ•°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¯¾å¿œ
- ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œå‡º
- è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

## æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®è¿½åŠ æ–¹æ³•

ã“ã®ãƒ‘ãƒ¼ã‚µãƒ¼ã¯ã€ç°¡å˜ã«æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿å½¢å¼ã«å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ï¼š

1. `config.py`ã®`SUPPORTED_EXTENSIONS`ã«æ–°ã—ã„æ‹¡å¼µå­ã‚’è¿½åŠ 
2. `json_parser.py`ï¼ˆã¾ãŸã¯æ–°ã—ã„ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«è§£æé–¢æ•°ã‚’è¿½åŠ 
3. `detect_format()`é–¢æ•°ã‚’æ‹¡å¼µã—ã¦æ–°ã—ã„å½¢å¼ã‚’æ¤œå‡º
4. æ–°ã—ã„å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…±é€šå½¢å¼ã«å¤‰æ›ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…

ä¾‹ãˆã°ã€GPXãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã«ã¯ï¼š

```python
# config.py
SUPPORTED_EXTENSIONS = [".json", ".gpx"]

# modules/gpx_parser.pyï¼ˆæ–°è¦ä½œæˆï¼‰
def parse_gpx_data(data, username):
    records = []
    # GPXãƒ‡ãƒ¼ã‚¿è§£æãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
    return records

# json_parser.py ã‚’æ‹¡å¼µ
def detect_format(data):
    if isinstance(data, list) and len(data) > 0 and 'startTime' in data[0]:
        return "iphone"
    elif isinstance(data, dict) and 'semanticSegments' in data:
        return "android"
    elif isinstance(data, str) and '<?xml' in data and '<gpx' in data:
        return "gpx"
    else:
        raise ValueError("ä¸æ˜ãªãƒ‡ãƒ¼ã‚¿å½¢å¼")

def parse_json_data(data, username):
    try:
        data_format = detect_format(data)
        
        if data_format == "android":
            return parse_android_data(data, username)
        elif data_format == "iphone":
            return parse_iphone_data(data, username)
        elif data_format == "gpx":
            from modules.gpx_parser import parse_gpx_data
            return parse_gpx_data(data, username)
        else:
            raise ValueError(f"æœªå¯¾å¿œã®å½¢å¼: {data_format}")
    except Exception as e:
        # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        return []
```

## ã‚«ãƒ©ãƒ å®šç¾©

å‡ºåŠ›CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚«ãƒ©ãƒ ã¯`config.py`ã®`CSV_COLUMNS`ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ï¼š

```python
CSV_COLUMNS = [
    "type",
    "start_time", 
    "end_time",
    "point_time",
    "latitude",
    "longitude",
    "visit_probability",
    "visit_placeId", 
    "visit_semanticType",
    "activity_distanceMeters",
    "activity_type", 
    "activity_probability",
    "username"
]
```

æ–°ã—ã„ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã¾ãŸã¯ä¸è¦ãªã‚«ãƒ©ãƒ ã‚’å‰Šé™¤ã™ã‚‹å ´åˆã¯ã€ã“ã®ãƒªã‚¹ãƒˆã‚’ç·¨é›†ã™ã‚‹ã ã‘ã§ã™ã€‚

## å°†æ¥ã®æ‹¡å¼µè¨ˆç”»

1. **æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿å½¢å¼å¯¾å¿œ**
   - GPXã€KMLå½¢å¼ã®ã‚µãƒãƒ¼ãƒˆ
   - Stravaã€Garminãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
   
2. **ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–**
   - åŸºæœ¬çš„ãªåœ°å›³ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã®çµ±åˆ
   - æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

3. **ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒªãƒƒãƒãƒ¡ãƒ³ãƒˆ**
   - å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã¨ã®çµ±åˆ
   - é€†ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆåº§æ¨™â†’ä½æ‰€/å ´æ‰€åï¼‰

4. **åˆ†ææ©Ÿèƒ½**
   - ç§»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æŠ½å‡º
   - çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯[LICENSE](LICENSE)ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## è²¢çŒ®æ–¹æ³•

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®è²¢çŒ®ã‚’æ­“è¿ã—ã¾ã™ï¼è²¢çŒ®ã‚’å§‹ã‚ã‚‹ã«ã¯ã€[CONTRIBUTING.md](CONTRIBUTING.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€ã™ã¹ã¦ã®è²¢çŒ®è€…ã¯[CODE_OF_CONDUCT.md](CODE_OF_CONDUCT.md)ã‚’é©åˆ‡ã«éµå®ˆã™ã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚
